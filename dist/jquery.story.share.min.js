/**
 * jquery.story.share 0.1.2
 **/

!function(a,b,c,d){function e(b,c){this.element=b,this.options=a.extend(!0,{},i,c),"fbAppId"in this.options&&(this.options=a.extend(!0,this.options,{socialProviders:{facebook_complex:{overrides:{app_id:this.options.fbAppId}},facebook_simple:{overrides:{app_id:this.options.fbAppId}}}})),this.shareHandler=this.shareHandler.bind(this),this._defaults=i,this.init()}var f,g,h="storyShare",i={windowWidth:500,windowHeight:300,relativeMediaUrls:!1,mediaBaseUrl:b.location.href.substring(0,b.location.href.lastIndexOf("/")+1),currentUrlPlaceholder:"{{current}}",mediaAttributes:{pinterest:["media"],facebook_complex:["picture"]},requiredLocalAttributes:{facebook_complex:["link"],facebook_simple:["url"],twitter:["url"],google_plus:["url"],linkedin:["url","title"],pinterest:["url","media"]},requiredGlobalAttributes:{facebook_complex:["fbAppId"]},shareUrlAttributes:{facebook_complex:["link"],facebook_simple:["url"],twitter:["url"],google_plus:["url"],linkedin:["url"],pinterest:["url"]},socialProviders:{facebook_simple:{urlBase:"https://www.facebook.com/sharer/sharer.php?u={url}"},facebook_complex:{urlBase:"https://www.facebook.com/v2.3/dialog/feed?app_id={app_id}&redirect_uri={redirect_uri}&link={link}&picture={picture}&caption={caption}&description={description}&name={name}&properties={properties}&actions={actions}&ref={ref}&display=popup",overrides:{redirect_uri:b.location.href+"#story_close_window"}},twitter:{urlBase:"https://twitter.com/intent/tweet?url={url}&text={text}&hashtags={hashtags}&via={via}"},google_plus:{urlBase:"https://plus.google.com/share?url={url}"},linkedin:{urlBase:"http://www.linkedin.com/shareArticle?mini=true&url={url}&source={source}&title={title}&summary={summary}"},pinterest:{urlBase:"https://pinterest.com/pin/create/button/?url={url}&media={media}&description={description}"}},debug:!1};a(c).ready(function(){-1!==b.location.hash.indexOf("#story_close_window")&&b.close()}),e.prototype={linkHandler:function(){var c=Math.floor(((screen.availWidth||1024)-this.options.windowWidth)/2),d=Math.floor(((screen.availHeight||700)-this.options.windowHeight)/2);if(this.generateSocialUrl(),!this.socialUrl)return!0;var e=b.open(this.socialUrl,"social","width="+this.options.windowWidth+",height="+this.options.windowHeight+",left="+c+",top="+d+",location=0,menubar=0,toolbar=0,status=0,scrollbars=1,resizable=1");return e&&(e.focus(),a(this.element).preventDefault&&a(this.element).preventDefault(),a(this.element).returnValue=!1),!!e},shareHandler:function(){this.linkHandler()},init:function(){a(this.element).on("click",this.shareHandler)},removeURLParameter:function(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-->0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);return a=c[0]+"?"+e.join("&")}return a},validateAttributes:function(){if(i.requiredLocalAttributes[g]&&Array.isArray(i.requiredLocalAttributes[g]))for(var a=0;a<i.requiredLocalAttributes[g].length;a++)if(!f.attr("data-"+i.requiredLocalAttributes[g][a]))throw this.socialUrl=null,"[Story-Share] Missing "+i.requiredLocalAttributes[g][a]+" for "+g;if(i.requiredGlobalAttributes[g]&&Array.isArray(i.requiredGlobalAttributes[g]))for(var b=0;b<i.requiredGlobalAttributes[g].length;b++)if(!this.options[i.requiredGlobalAttributes[g][b]])throw this.socialUrl=null,"[Story-Share] Missing "+i.requiredGlobalAttributes[g][b]+" for "+g},generateSocialUrl:function(){if(f=a(this.element),!f.attr("data-type"))throw"[Story-Share] The data-type attribute is required";g=f.attr("data-type").replace("-","_");var c=this,e=g in this.options.socialProviders?this.options.socialProviders[g]:null;if(null===e)throw"[Story-Share] Type "+g+" is not supported";this.validateAttributes();var h=e.urlBase,i=/{([^}]*)}/g,j=h.match(i)||[],k=e.overrides||{};j.forEach(function(a){var e=null;a=a.replace("{","").replace("}",""),a in k&&(e=k[a]);var i=a.replace("{","").replace("}",""),j="data-"+i,l=e||f.attr(j);c.options.relativeMediaUrls&&l&&g in c.options.mediaAttributes&&c.options.mediaAttributes[g].indexOf(i)>-1&&(l=c.options.mediaBaseUrl+l),l===c.options.currentUrlPlaceholder&&c.options.shareUrlAttributes[g].indexOf(i)>-1&&(l=b.location.href),l=l!==d?l:null,null===l&&(h=c.removeURLParameter(h,j.replace("data-",""))),h=h.replace("{"+a+"}",encodeURIComponent(l))}),this.socialUrl=h}},a.fn[h]=function(b){return b&&b.debug?new e(this,b):this.each(function(){a.data(this,"plugin_"+h)||a.data(this,"plugin_"+h,new e(this,b))})}}(jQuery,window,document);